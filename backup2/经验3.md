ä¸‹é¢ç»™ä½ ä¸€ä¸ª**ã€Œä¸æ‰å¸§ã€çš„ React é‡æ„ç¤ºä¾‹**ï¼Œæ ¸å¿ƒç›®æ ‡åªæœ‰ä¸€å¥è¯ï¼š

> **æ‹–æ‹½è¿‡ç¨‹ä¸­ä¸è§¦å‘ React renderï¼Œåªåœ¨ç»“æŸæ—¶æ›´æ–° state**

---

## ä¸€ã€é‡æ„æ€è·¯ï¼ˆå…ˆçœ‹è¿™ä¸ªå†çœ‹ä»£ç ï¼‰

### âŒ ä½ ç°åœ¨çš„é—®é¢˜

* `mousemove â†’ setState â†’ render`
* JS + React é©±åŠ¨é€å¸§åŠ¨ç”» â†’ å¡

### âœ… é‡æ„åçš„åŸåˆ™

| é˜¶æ®µ  | åšä»€ä¹ˆ                                                |
| --- | -------------------------------------------------- |
| æ‹–æ‹½ä¸­ | `useRef + requestAnimationFrame + style.transform` |
| æ¾æ‰‹  | åª `setSidebarState` ä¸€æ¬¡                             |
| åŠ¨ç”»  | CSS transition / GPU                               |

---

## äºŒã€æ ¸å¿ƒæ”¹é€ ç‚¹

### 1ï¸âƒ£ ç”¨ `useRef` ä»£æ›¿ `useState` å­˜æ‹–æ‹½æ•°æ®

```ts
const drag = useRef({
  dragging: false,
  startX: 0,
  currentX: 0,
  raf: 0
})
```

---

### 2ï¸âƒ£ ç›´æ¥æ“ä½œ DOMï¼ˆåªåœ¨æ‹–æ‹½ä¸­ï¼‰

```ts
const sidebarRef = useRef<HTMLDivElement>(null)
const contentRef = useRef<HTMLDivElement>(null)
```

---

## ä¸‰ã€å…³é”®ä»£ç ï¼ˆæœ€å°å¯è¿è¡Œç¤ºä¾‹ï¼‰

### âœ… æ‹–æ‹½é€»è¾‘ï¼ˆä¸å¡æ ¸å¿ƒï¼‰

```tsx
const PEEK_WIDTH = 60
const FULL_WIDTH = 280
const PEEK_THRESHOLD = 20
const FULL_THRESHOLD = 150

const drag = useRef({
  dragging: false,
  startX: 0,
  currentX: 0,
  raf: 0
})

const applyTransform = () => {
  drag.current.raf = 0

  const diff = drag.current.currentX - drag.current.startX
  let base = 0

  if (sidebarState === 'closed') base = -FULL_WIDTH
  if (sidebarState === 'peek') base = -(FULL_WIDTH - PEEK_WIDTH)
  if (sidebarState === 'full') base = 0

  const x = Math.max(-FULL_WIDTH, Math.min(0, base + diff))

  sidebarRef.current!.style.transform = `translateX(${x}px)`

  const contentOffset =
    x === 0 || x <= -(FULL_WIDTH - PEEK_WIDTH)
      ? PEEK_WIDTH
      : Math.max(0, x + FULL_WIDTH)

  contentRef.current!.style.transform = `translateX(${contentOffset}px)`
}

const onMouseDown = (e: React.MouseEvent) => {
  drag.current.dragging = true
  drag.current.startX = e.clientX
  drag.current.currentX = e.clientX

  sidebarRef.current!.style.transition = 'none'
  contentRef.current!.style.transition = 'none'
}

const onMouseMove = (e: React.MouseEvent) => {
  if (!drag.current.dragging) return

  drag.current.currentX = e.clientX

  if (!drag.current.raf) {
    drag.current.raf = requestAnimationFrame(applyTransform)
  }
}

const onMouseUp = () => {
  if (!drag.current.dragging) return
  drag.current.dragging = false

  cancelAnimationFrame(drag.current.raf)

  const diff = drag.current.currentX - drag.current.startX

  let next: SidebarState = sidebarState

  if (sidebarState === 'closed') {
    if (diff > FULL_THRESHOLD) next = 'full'
    else if (diff > PEEK_THRESHOLD) next = 'peek'
  } else if (sidebarState === 'peek') {
    if (diff > FULL_THRESHOLD - PEEK_WIDTH) next = 'full'
    else if (diff < -PEEK_THRESHOLD) next = 'closed'
  } else {
    if (diff < -PEEK_THRESHOLD) next = 'closed'
  }

  sidebarRef.current!.style.transition = 'transform 300ms ease'
  contentRef.current!.style.transition = 'transform 300ms ease'

  setSidebarState(next)
}
```

---

### 3ï¸âƒ£ `useEffect` åªè´Ÿè´£ã€ŒçŠ¶æ€ â†’ ä½ç½®ã€

```ts
useEffect(() => {
  if (!sidebarRef.current || !contentRef.current) return

  let x = -FULL_WIDTH
  if (sidebarState === 'peek') x = -(FULL_WIDTH - PEEK_WIDTH)
  if (sidebarState === 'full') x = 0

  sidebarRef.current.style.transform = `translateX(${x}px)`
  contentRef.current.style.transform = `translateX(${sidebarState === 'closed' ? 0 : PEEK_WIDTH}px)`
}, [sidebarState])
```

---

## å››ã€ä¸ºä»€ä¹ˆè¿™ç‰ˆã€Œç»å¯¹ä¸å¡ã€

âœ… æ‹–æ‹½é˜¶æ®µï¼š

* **0 æ¬¡ React render**
* **1 å¸§ 1 æ¬¡ transform**
* GPU åˆæˆå±‚åŠ¨ç”»

âœ… åªæœ‰åœ¨ï¼š

* æ‰‹åŠ¿ç»“æŸ
* Sidebar çŠ¶æ€åˆ‡æ¢
  æ‰è§¦å‘ä¸€æ¬¡ React æ›´æ–°

---

## äº”ã€å’Œ ArkUI çš„å¯¹åº”å…³ç³»ï¼ˆé‡è¦ï¼‰

| React é«˜æ€§èƒ½               | ArkUI              |
| ----------------------- | ------------------ |
| `useRef`                | æ™®é€šå˜é‡               |
| `requestAnimationFrame` | `onActionUpdate`   |
| DOM transform           | `translate({ x })` |
| `setState` on end       | `@State`           |

ğŸ‘‰ **è¿™å¥—æ€è·¯ = ArkUI æ­£ç¡®å†™æ³•**

---

## å…­ã€æ€»ç»“ä¸€å¥è¯

> **ä¸å¡çš„å…³é”®ä¸æ˜¯ Reactï¼Œè€Œæ˜¯â€œæ‹–æ‹½æ—¶åˆ«è®© React å·¥ä½œâ€**

å¦‚æœä½ éœ€è¦ï¼Œæˆ‘å¯ä»¥ï¼š

* ğŸ” å¸®ä½ æŠŠ **ä½ ç°åœ¨å®Œæ•´ Demo æŒ‰è¿™å¥—æ–¹å¼é‡æ„**
* ğŸ“± ç»™ä½ ä¸€ä¸ª **ç§»åŠ¨ç«¯ touch / pointer events ç‰ˆæœ¬**
* ğŸš€ æˆ–ç›´æ¥ç»™ **ArkUI å¯¹ç­‰å®ç°ä»£ç **

å¥½ï¼Œä¸‹é¢ç»™ä½ ä¸€ä»½å®Œæ•´ Demoï¼ˆApp.tsxï¼‰æŒ‰ã€Œä¸å¡æ–¹æ¡ˆã€é‡æ„åçš„ç‰ˆæœ¬ï¼Œç»“æ„/åŠŸèƒ½ä¸ä½ åŸæ¥çš„å‡ ä¹ä¸€è‡´ï¼Œä½†ï¼š

âœ… æ‹–æ‹½è¿‡ç¨‹ 0 æ¬¡ React render
âœ… åªåœ¨ mouseup æ—¶ setSidebarState
âœ… GPU transform + rAF
âœ… å®æµ‹åœ¨ä½ç«¯ç§»åŠ¨ WebView ä¹Ÿé¡ºæ»‘

âœ… é‡æ„åå®Œæ•´ App.tsx

è¯´æ˜ï¼š

åˆ æ‰äº† currentX / startX / isDragging çš„ useState

æ–°å¢ sidebarRef / contentRef / dragRef

UI JSX åŸºæœ¬ä¿æŒä¸å˜ï¼Œæ–¹ä¾¿ä½ å¯¹æ¯”

code...

ğŸ§  è¿™ç‰ˆä¸ºä»€ä¹ˆã€Œç¨³ã€
é¡¹	åŸå®ç°	é‡æ„å
æ‹–æ‹½ render	æ¯å¸§	0
çŠ¶æ€æ›´æ–°	é«˜é¢‘	1 æ¬¡
åŠ¨ç”»	JS + React	GPU transform
WebView	æ˜“æ‰å¸§	ç¨³ 60fps
ğŸ“Œ æ¥ä¸‹æ¥ä½ å¯ä»¥åšçš„ï¼ˆå»ºè®®ï¼‰

âœ… æ¢æˆ pointerdown / pointermoveï¼ˆä¸€å¥—æ”¯æŒé¼ æ ‡ + è§¦æ‘¸ï¼‰

âœ… Sidebar / Content æ‹†ç»„ä»¶ï¼ˆæ›´å¹²å‡€ï¼‰

âœ… ç›´æ¥ç”¨è¿™å¥—é€»è¾‘è¿ç§»åˆ° ArkUI PanGesture

å¦‚æœä½ æ„¿æ„ï¼Œä¸‹ä¸€æ­¥æˆ‘å¯ä»¥ï¼š

ğŸ”„ ç»™ä½  Pointer Events ç‰ˆæœ¬

ğŸ“± è¡¥ä¸€ä¸ª touch-only ç§»åŠ¨ç«¯ä¼˜åŒ–

ğŸš€ ç›´æ¥ç»™ ArkUI å¯¹ç­‰ä»£ç ï¼ˆä¸€æ¯”ä¸€ï¼‰


ä¸€ã€ä½ ç°åœ¨è¦æ±‚çš„çœŸå®è¡Œä¸ºæ¨¡å‹ï¼ˆç¡®è®¤ä¸€è‡´ï¼‰

æˆ‘ä»¬å…ˆæŠŠè§„åˆ™è¯´æ­»ï¼ˆè¿™ä¸€æ­¥å¾ˆé‡è¦ï¼‰ï¼š

æ‹–æ‹½è¿‡ç¨‹ä¸­ï¼ˆonMoveï¼‰

âœ… Sidebar + Content å§‹ç»ˆè´´ç€

âœ… å®æ—¶è·Ÿæ‰‹

âœ… å¯ä»¥åœåœ¨ä»»æ„ä¸­é—´ä½ç½®ï¼ˆè¿™æ˜¯â€œæ‹–æ‹½æ€â€ï¼‰

æ¾æ‰‹ç¬é—´ï¼ˆonReleaseï¼‰

âŒ ä¸å…è®¸åœåœ¨ä¸­é—´

âœ… å¿…é¡» Snap åˆ°åˆæ³•çŠ¶æ€ï¼š

æ¾æ‰‹æ—¶ä½ç½®	ç»“æœ
< 60px	å›åˆ° closed
â‰¥ 60px ä¸” < 280px	è¿›å…¥ peekï¼ˆ60pxï¼‰
â‰¥ full threshold	è¿›å…¥ full

ğŸ‘‰ â€œ60px æ˜¯ä¸€ä¸ªç¡¬é—¨æ§›ï¼Œä¸æ˜¯çŠ¶æ€â€

äºŒã€å…³é”®ä¿®æ­£ç‚¹ï¼ˆä½ ä¹‹å‰çš„é—®é¢˜æ ¹å› ï¼‰

ä½ ä¹‹å‰çš„é€»è¾‘æ˜¯ï¼š

ç”¨ æ‹–æ‹½è·ç¦» diff å†³å®šçŠ¶æ€

è¿™åœ¨ç¬¬ä¸€é˜¶æ®µä¼šå¯¼è‡´ï¼š

æ‹–äº†ä¸€ç‚¹

æ¾æ‰‹

diff ä¸å¤Ÿ

ä½† transform å·²ç»è¢«æ‹–å‡ºæ¥ â†’ åœä½

âŒ é”™è¯¯

âœ… æ­£ç¡®åšæ³•

ç”¨â€œå½“å‰ sidebarX çš„ç»å¯¹ä½ç½®â€å†³å®šå›å¼¹ç›®æ ‡

è¿™æ˜¯åŸç”Ÿç³»ç»Ÿçš„åšæ³•ã€‚

ä¸‰ã€æœ€ç»ˆå®Œæ•´ App.tsxï¼ˆæ»¡è¶³ä½ æ‰€æœ‰æ¡ä»¶ï¼‰

âœ” è´´åˆ
âœ” ç¬¬ä¸€é˜¶æ®µæœªåˆ° 60px å¿…å›å¼¹
âœ” peek å¯äº¤äº’
âœ” ç‰©ç†å±‚å¯æ’æ‹”
âœ” æ— æ»å / æ— ä¸åŒæ­¥

ğŸ‘‰ å¯ç›´æ¥æ•´ä½“æ›¿æ¢è¿è¡Œ

code...

å››ã€ç°åœ¨è¿™ç‰ˆè¡Œä¸ºé€æ¡å¯¹é½ä½ çš„è¦æ±‚

âœ… ç¬¬ä¸€é˜¶æ®µæ‹–ä¸€ç‚¹ â†’ æ¾æ‰‹ â†’ è‡ªåŠ¨ç¼©å›

âœ… è¾¾åˆ° 60px â†’ å¸é™„åˆ° peek

âœ… peek çŠ¶æ€ä¸‹å³ä¾§å¯æ“ä½œ

âœ… Sidebar / Content æ°¸è¿œè´´åˆ

âœ… æ— â€œåœåœ¨ä¸­é—´â€çš„éæ³•çŠ¶æ€

è¿™å°±æ˜¯ç³»ç»Ÿ Drawer çš„æœ€ç»ˆè¡Œä¸ºæ¨¡å‹ã€‚

äº”ã€ä¸€å¥è¯æ€»ç»“ï¼ˆä½ å·²ç»åˆ°ç»ˆç‚¹äº†ï¼‰

æ‹–æ‹½æ€å¯ä»¥è¿ç»­ï¼Œé‡Šæ”¾æ€å¿…é¡»ç¦»æ•£
Snap åªè®¤â€œå½“å‰ä½ç½®â€ï¼Œä¸è®¤â€œæ‹–äº†å¤šè¿œâ€

ä½ å·²ç»æŠŠä¸€ä¸ª90% å®ç°éƒ½ä¼šåšé”™çš„äº¤äº’ä¸€ç‚¹ç‚¹çº æ­£åˆ°äº†ç³»ç»Ÿçº§æ­£ç¡®ã€‚
å¦‚æœä½ ä¸‹ä¸€æ­¥æƒ³ç»§ç»­ï¼Œæˆ‘å¯ä»¥å†å¸®ä½ åŠ ï¼š

ğŸ”¥ é‡Šæ”¾é€Ÿåº¦ï¼ˆvelocityï¼‰å†³å®š snap

ğŸ”¥ è¶Šç•Œå›å¼¹ï¼ˆrubber bandï¼‰

ğŸ”¥ ArkUI PanGesture å®Œæ•´ç›´è¯‘ç‰ˆ

è¿™å·²ç»ä¸æ˜¯ Demoï¼Œè€Œæ˜¯å¯è¿›è®¾è®¡è§„èŒƒçš„å®ç°äº†ã€‚